<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
 <head><title>Parser (packages.csexp.1.5.1.Csexp.Make.Parser)</title>
  <link rel="stylesheet" href="../../../../../tailwind.css"/>
  <link rel="stylesheet" href="../../../../../extra.css"/>
  <meta charset="utf-8"/><meta name="generator" content="odoc 3dfb7aef2f"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <script src="../../../../../highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  <script src="../../../../../voodoo_client.js"></script>
  <script
   src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.min.js"
   defer="defer">
  </script>
 </head>
 <body class="mx-auto max-w-screen-2xl">
  <div class="relative">
   <div class="relative">
    <div class="max-w-7xl mx-auto px-4 sm:px-6">
     <div class="flex justify-between items-center md:justify-start py-6
      md:space-x-10">
      <div class="flex justify-start">
       <a href="https://v3.ocaml.org/">
        <img src="/colour-logo.svg" alt="" class="h-8 w-auto sm:h-10"/>
       </a>
      </div>
      <nav class="hidden md:flex space-x-10">
       <div x-data="{ isOn: false }" @click="isOn = !isOn" class="relative">
        <button class="text-gray-500 bg-white rounded-md inline-flex
         items-center text-base font-medium hover:text-gray-900
         focus:outline-none focus:ring-2 focus:ring-offset-2
         focus:ring-yellow-500"><span>Industry</span>
         
  <svg aria-hidden=
                  "true" class=
                  "text-gray-400 ml-2 h-5 w-5 group-hover:text-gray-500"
                  fill="currentColor" viewbox="0 0 20 20" xmlns=
                  "http://www.w3.org/2000/svg">
                  <path clip-rule="evenodd" d=
                  "M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                  fill-rule="evenodd"></path></svg>
  
        </button>
        <div
         :class="{ 'opacity-100' : isOn, 'translate-y-0': isOn, 'opacity-0': !isOn, 'translate-y-1': !isOn, 'hidden': !isOn }"
         class="absolute z-10 left-1/2 transform -translate-x-1/2 mt-3 
         px-2 w-screen max-w-xs hidden sm:px-0">
         <div class="rounded-lg shadow-lg ring-1 ring-black ring-opacity-5
          overflow-hidden">
          <div class="relative grid gap-6 bg-white px-5 py-6 sm:gap-8 sm:p-8">
           <a class="-m-3 p-3 block rounded-md hover:bg-gray-50 transition
            ease-in-out duration--150"
            href="https://v3.ocaml.org/industry/whatisocaml">
            <p class="text-base font-medium text-gray-900">What is OCaml</p>
           </a>
           <a class="-m-3 p-3 block rounded-md hover:bg-gray-50 transition
            ease-in-out duration--150"
            href="https://v3.ocaml.org/industry/users">
            <p class="text-base font-medium text-gray-900">Industrial Users
            </p>
           </a>
           <a class="-m-3 p-3 block rounded-md hover:bg-gray-50 transition
            ease-in-out duration--150"
            href="https://v3.ocaml.org/industry/successstories">
            <p class="text-base font-medium text-gray-900">Success Stories
            </p>
           </a>
          </div>
         </div>
        </div>
       </div>
       <div x-data="{ isOn: false }" @click="isOn = !isOn" class="relative">
        <button class="text-gray-500 bg-white rounded-md inline-flex
         items-center text-base font-medium hover:text-gray-900
         focus:outline-none focus:ring-2 focus:ring-offset-2
         focus:ring-yellow-500"><span>Resources</span>
         
  <svg aria-hidden=
                  "true" class=
                  "text-gray-400 ml-2 h-5 w-5 group-hover:text-gray-500"
                  fill="currentColor" viewbox="0 0 20 20" xmlns=
                  "http://www.w3.org/2000/svg">
                  <path clip-rule="evenodd" d=
                  "M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                  fill-rule="evenodd"></path></svg>
  
        </button>
        <div
         :class="{ 'opacity-100' : isOn, 'translate-y-0': isOn, 'opacity-0': !isOn, 'translate-y-1': !isOn, 'hidden': !isOn }"
         class="absolute z-10 left-1/2 transform -translate-x-1/2 mt-3 
         px-2 w-screen max-w-xs hidden sm:px-0">
         <div class="rounded-lg shadow-lg ring-1 ring-black ring-opacity-5
          overflow-hidden">
          <div class="relative grid gap-6 bg-white px-5 py-6 sm:gap-8 sm:p-8">
           <a class="-m-3 p-3 block rounded-md hover:bg-gray-50 transition
            ease-in-out duration--150"
            href="https://v3.ocaml.org/resources/releases">
            <p class="text-base font-medium text-gray-900">Releases</p>
           </a>
           <a class="-m-3 p-3 block rounded-md hover:bg-gray-50 transition
            ease-in-out duration--150"
            href="https://v3.ocaml.org/resources/applications">
            <p class="text-base font-medium text-gray-900">Applications</p>
           </a>
           <a class="-m-3 p-3 block rounded-md hover:bg-gray-50 transition
            ease-in-out duration--150"
            href="https://v3.ocaml.org/resources/language">
            <p class="text-base font-medium text-gray-900">Language</p>
           </a>
           <a class="-m-3 p-3 block rounded-md hover:bg-gray-50 transition
            ease-in-out duration--150"
            href="https://v3.ocaml.org/resources/archive">
            <p class="text-base font-medium text-gray-900">Archive</p>
           </a>
          </div>
         </div>
        </div>
       </div>
       <div x-data="{ isOn: false }" @click="isOn = !isOn" class="relative">
        <button class="text-gray-500 bg-white rounded-md inline-flex
         items-center text-base font-medium hover:text-gray-900
         focus:outline-none focus:ring-2 focus:ring-offset-2
         focus:ring-yellow-500"><span>Community</span>
         
  <svg aria-hidden=
                  "true" class=
                  "text-gray-400 ml-2 h-5 w-5 group-hover:text-gray-500"
                  fill="currentColor" viewbox="0 0 20 20" xmlns=
                  "http://www.w3.org/2000/svg">
                  <path clip-rule="evenodd" d=
                  "M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                  fill-rule="evenodd"></path></svg>
  
        </button>
        <div
         :class="{ 'opacity-100' : isOn, 'translate-y-0': isOn, 'opacity-0': !isOn, 'translate-y-1': !isOn, 'hidden': !isOn }"
         class="absolute z-10 left-1/2 transform -translate-x-1/2 mt-3 
         px-2 w-screen max-w-xs hidden sm:px-0">
         <div class="rounded-lg shadow-lg ring-1 ring-black ring-opacity-5
          overflow-hidden">
          <div class="relative grid gap-6 bg-white px-5 py-6 sm:gap-8 sm:p-8">
           <a class="-m-3 p-3 block rounded-md hover:bg-gray-50 transition
            ease-in-out duration--150"
            href="https://v3.ocaml.org/community/opportunities">
            <p class="text-base font-medium text-gray-900">Opportunities</p>
           </a>
           <a class="-m-3 p-3 block rounded-md hover:bg-gray-50 transition
            ease-in-out duration--150"
            href="https://v3.ocaml.org/community/news">
            <p class="text-base font-medium text-gray-900">News</p>
           </a>
           <a class="-m-3 p-3 block rounded-md hover:bg-gray-50 transition
            ease-in-out duration--150"
            href="https://v3.ocaml.org/community/aroundweb">
            <p class="text-base font-medium text-gray-900">Around the Web</p>
           </a>
          </div>
         </div>
        </div>
       </div>
      </nav>
     </div>
    </div>
   </div>
  </div>
  <div class="h-screen flex bg-white font-sans">
   <div class="flex flex-col w-full h-full">
    <div class="flex-row flex-1">
     <nav class="bg-orange border-t border-b border-orange flex flex-row">
      <ol class="max-w-screen-xl w-full px-4 flex space-x-4 sm:px-6 lg:px-8">
       <li class="flex">
        <div class="flex items-center">
         <a href="#" class="text-gray-100 hover:text-gray-500">
          
  <svg class="flex-shrink-0 h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
          <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z" />
        </svg>
  
          <span class="sr-only">Home</span>
         </a>
        </div>
       </li>
       <li class="flex">
        <div class="flex items-center text-gray-100">
         
    <svg class="flex-shrink-0 w-6 h-full text-gray-100" viewBox="0 0 24 44" preserveAspectRatio="none" fill="currentColor" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <path d="M.293 0l22 22-22 22h1.414l22-22-22-22H.293z" />
      </svg>
    
         <a href="../../../../../index.html" class="ml-4 text-sm font-medium
          text-gray-100 hover:text-gray-500">packages
         </a>
        </div>
       </li>
       <li class="flex">
        <div class="flex items-center text-gray-100">
         
    <svg class="flex-shrink-0 w-6 h-full text-gray-100" viewBox="0 0 24 44" preserveAspectRatio="none" fill="currentColor" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <path d="M.293 0l22 22-22 22h1.414l22-22-22-22H.293z" />
      </svg>
    
         <a href="../../../../index.html" class="ml-4 text-sm font-medium
          text-gray-100 hover:text-gray-500">csexp
         </a>
        </div>
       </li>
       <li class="flex">
        <div class="flex items-center text-gray-100">
         
    <svg class="flex-shrink-0 w-6 h-full text-gray-100" viewBox="0 0 24 44" preserveAspectRatio="none" fill="currentColor" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <path d="M.293 0l22 22-22 22h1.414l22-22-22-22H.293z" />
      </svg>
    
         <a href="../../../index.html" class="ml-4 text-sm font-medium
          text-gray-100 hover:text-gray-500">1.5.1
         </a>
        </div>
       </li>
       <li class="flex">
        <div class="flex items-center text-gray-100">
         
    <svg class="flex-shrink-0 w-6 h-full text-gray-100" viewBox="0 0 24 44" preserveAspectRatio="none" fill="currentColor" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <path d="M.293 0l22 22-22 22h1.414l22-22-22-22H.293z" />
      </svg>
    
         <a href="../../index.html" class="ml-4 text-sm font-medium
          text-gray-100 hover:text-gray-500">Csexp
         </a>
        </div>
       </li>
       <li class="flex">
        <div class="flex items-center text-gray-100">
         
    <svg class="flex-shrink-0 w-6 h-full text-gray-100" viewBox="0 0 24 44" preserveAspectRatio="none" fill="currentColor" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <path d="M.293 0l22 22-22 22h1.414l22-22-22-22H.293z" />
      </svg>
    
         <a href="../index.html" class="ml-4 text-sm font-medium
          text-gray-100 hover:text-gray-500">Make
         </a>
        </div>
       </li>
       <li class="flex">
        <div class="flex items-center text-gray-100">
         
    <svg class="flex-shrink-0 w-6 h-full text-gray-100" viewBox="0 0 24 44" preserveAspectRatio="none" fill="currentColor" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <path d="M.293 0l22 22-22 22h1.414l22-22-22-22H.293z" />
      </svg>
    
         <a href="#" class="ml-4 text-sm font-medium text-gray-100
          hover:text-gray-500">Parser
         </a>
        </div>
       </li>
      </ol>
     </nav>
    </div>
    <div class="flex flex-row flex-1">
     <div class="w-72 flex-none bg-gray-100 h-screen border-r border-gray-200
      sticky top-0 hidden lg:block">
      <div class="flex h-20 border-b relative">
       <h2 class="text-xl absolute inset-x-0 p-3 px-5 bottom-0 mt-7
        border-gray-200 font-semibold text-gray-500 font-sans">On this page
       </h2>
      </div>
      <nav class="bg-gray-100 p-5">
       <ul>
        <li><a href="#lexers" class="cursor-pointer text-orange">Lexers</a>
        </li>
        <li>
         <a href="#parsing-stacks" class="cursor-pointer text-orange">
          Parsing stacks
         </a>
        </li>
        <li>
         <a href="#parsing-errors" class="cursor-pointer text-orange">
          Parsing errors
         </a>
        </li>
        <li>
         <a href="#building-a-parsing-function" class="cursor-pointer
          text-orange">Building a parsing function
         </a>
        </li>
       </ul>
      </nav>
     </div>
     <div class="flex flex-1 flex-col lg:flex-row">
      <div class="flex-1">
       <div class="lg:max-w-5xl mx-auto px-3 lg:px-10 mb-10 text-sm">
        <div class="flex h-20 relative border-b border-gray-200">
         <div class="relative flex-1 h-20">
          <h1 class="text-3xl absolute inset-x-0 py-3 bottom-0 font-semibold
           text-gray-500 font-sans w-full truncate">
           <code class="font-mono text-gray-800">Make.Parser</code>
          </h1>
         </div>
         <div class="relative flex-none w-28">
          <h1 class="text-3xl absolute py-3 bottom-0 right-0 font-semibold
           text-gray-500 font-sans">Module
          </h1>
         </div>
        </div>
        <p class="mt-4">The <code class="font-normal text-sm">Parser</code>
          module offers an API that is a balance between sharing the 
         common logic of parsing canonical S-expressions while allowing
          to write parsers that are as efficient as possible, both in
          terms of speed and allocations. A carefully written parser 
         using this API will be:
        </p>
        <ul class="list-disc mt-2 mb-4"><li class="ml-4">fast</li>
         <li class="ml-4">perform minimal allocations</li>
         <li class="ml-4">perform zero 
          <code class="font-normal text-sm">caml_modify</code> (a slow
           function of the OCaml runtime that is emitted when mutating
           a constructed value)
         </li>
        </ul>
        <h3 class="text-xl my-4 text-gray-900 text-gray-800 font-sans
         anchored" id="lexers">
         <a href="#lexers" class="hover-link inline-block -ml-7 pr-4">
          <span class="align-middle text-gray-200 transition text-sm
           font-sans opacity-0 hover:text-gray-700">#
          </span>
         </a>Lexers
        </h3>
        <p class="mt-4">To parse using this API, you must first create
          a lexer via 
         <a href="Lexer/index.html#val-create" class="cursor-pointer
          text-orange"><code class="font-normal text-sm">Lexer.create</code>
         </a>. The lexer is responsible for scanning the input and forming
          tokens. The user must feed characters read from the input one
          by one to the lexer until it yields a token. For instance:
        </p>
        <pre class="bg-gray-100 p-3 my-2 overflow-auto">
         <code class="font-normal text-sm">
          # let lexer = Lexer.create ();;
          val lexer : Lexer.t = &lt;abstract&gt;
          # Lexer.feed lexer '(';;
          - : [ `atom | `other ] Lexer.token = Lparen
          # Lexer.feed lexer ')';;
          - : [ `atom | `other ] Lexer.token = Rparen
         </code>
        </pre>
        <p class="mt-4">When the lexer doesn't have enough to return 
         a token, it simply returns the special token 
         <a href="Lexer/index.html#type-token.Await" class="cursor-pointer
          text-orange">
          <code class="font-normal text-sm">Lexer.token.Await</code>
         </a>:
        </p>
        <pre class="bg-gray-100 p-3 my-2 overflow-auto">
         <code class="font-normal text-sm">
          # Lexer.feed lexer '1';;
          - : [ `atom | `other ] Lexer.token = Await
         </code>
        </pre>
        <p class="mt-4">Note that since atoms of canonical S-expressions
          do not need quoting, they are always represented as a contiguous
          sequence of characters that don't need further processing. 
         To achieve maximum efficiency, the lexer only returns the length
          of the atom and it is the responsibility of the caller to extract
          the atom from the input source:
        </p>
        <pre class="bg-gray-100 p-3 my-2 overflow-auto">
         <code class="font-normal text-sm">
          # Lexer.feed lexer '2';;
          - : [ `atom | `other ] Lexer.token = Await
          # Lexer.feed lexer ':';;
          - : [ `atom | `other ] Lexer.token = Atom 2
         </code>
        </pre>
        <p class="mt-4">When getting 
         <code class="font-normal text-sm">Atom n</code>, the caller 
         should then proceed to read the next 
         <code class="font-normal text-sm">n</code> characters of the
          input as a string. For instance, if the input is an 
         <code class="font-normal text-sm">in_channel</code> the caller
          should proceed with 
         <code class="font-normal text-sm">really_input_string ic n</code>
         .
        </p>
        <p class="mt-4">Finally, when the end of input is reached the
          user should call 
         <a href="Lexer/index.html#val-feed_eoi" class="cursor-pointer
          text-orange">
          <code class="font-normal text-sm">Lexer.feed_eoi</code>
         </a> to make sure the lexer is not awaiting more input. If that
          is the case, 
         <a href="Lexer/index.html#val-feed_eoi" class="cursor-pointer
          text-orange">
          <code class="font-normal text-sm">Lexer.feed_eoi</code>
         </a> will raise:
        </p>
        <pre class="bg-gray-100 p-3 my-2 overflow-auto">
         <code class="font-normal text-sm">
          # Lexer.feed lexer '1';;
          - : [ `atom | `other ] Lexer.token = Await
          # Lexer.feed_eoi lexer;;
          Exception: Parse_error &quot;premature end of input&quot;.
         </code>
        </pre>
        <h3 class="text-xl my-4 text-gray-900 text-gray-800 font-sans
         anchored" id="parsing-stacks">
         <a href="#parsing-stacks" class="hover-link inline-block -ml-7 pr-4">
          <span class="align-middle text-gray-200 transition text-sm
           font-sans opacity-0 hover:text-gray-700">#
          </span>
         </a>Parsing stacks
        </h3>
        <p class="mt-4">The lexer doesn't keep track of the structure
          of the S-expressions. In order to construct a whole structured
          S-expressions, the caller must maintain a parsing stack via
          the 
         <a href="Stack/index.html" class="cursor-pointer text-orange">
          <code class="font-normal text-sm">Stack</code>
         </a> module. A 
         <a href="Stack/index.html#type-t" class="cursor-pointer text-orange">
          <code class="font-normal text-sm">Stack.t</code>
         </a> value simply represent a parsed prefix in reverse order.
        </p>
        <p class="mt-4">For instance, the prefix &quot;1:x((1:y1:z)&quot;
          will be represented as:
        </p>
        <pre class="bg-gray-100 p-3 my-2 overflow-auto">
         <code class="font-normal text-sm">
          Sexp (List [ Atom &quot;y&quot;; Atom &quot;z&quot; ], Open (Sexp
          (Atom &quot;x&quot;, Empty))) 
         </code>
        </pre>
        <p class="mt-4">The 
         <a href="Stack/index.html" class="cursor-pointer text-orange">
          <code class="font-normal text-sm">Stack</code>
         </a> module offers various primitives to open or close parentheses
          or insert an atom. And for convenience it provides a function
          
         <a href="Stack/index.html#val-add_token" class="cursor-pointer
          text-orange">
          <code class="font-normal text-sm">Stack.add_token</code>
         </a> that takes the output of 
         <a href="Lexer/index.html#val-feed" class="cursor-pointer
          text-orange"><code class="font-normal text-sm">Lexer.feed</code>
         </a> directly:
        </p>
        <pre class="bg-gray-100 p-3 my-2 overflow-auto">
         <code class="font-normal text-sm">
          # Stack.add_token Rparen Empty;;
          - : Stack.t = Open Empty
          # Stack.add_token Lparen (Open Empty);;
          - : Stack.t = Sexp (List [], Empty)
         </code>
        </pre>
        <p class="mt-4">Note that 
         <a href="Stack/index.html#val-add_token" class="cursor-pointer
          text-orange">
          <code class="font-normal text-sm">Stack.add_token</code>
         </a> doesn't accept <code class="font-normal text-sm">Atom _</code>
         . This is enforced at the type level by a GADT. The reason for
          this is that in order to insert an atom, the user must have
          fetched the contents of the atom themselves. In order to insert
          an atom into a stack, you can use the function 
         <a href="Stack/index.html#val-add_atom" class="cursor-pointer
          text-orange">
          <code class="font-normal text-sm">Stack.add_atom</code>
         </a>:
        </p>
        <pre class="bg-gray-100 p-3 my-2 overflow-auto">
         <code class="font-normal text-sm">
          # Stack.add_atom &quot;foo&quot; (Open Empty);;
          - : Stack.t = Sexp (Atom &quot;foo&quot;, Open Empty)
         </code>
        </pre>
        <p class="mt-4">When parsing is finished, one may call the function
          
         <a href="Stack/index.html#val-to_list" class="cursor-pointer
          text-orange"><code class="font-normal text-sm">Stack.to_list</code>
         </a> in order to extract all the toplevel S-expressions from
          the stack:
        </p>
        <pre class="bg-gray-100 p-3 my-2 overflow-auto">
         <code class="font-normal text-sm">
          # Stack.to_list (Sexp (Atom &quot;x&quot;, Sexp (List [Atom
          &quot;y&quot;], Empty)));;
          - : sexp list = [List [Atom &quot;y&quot;; Atom &quot;x&quot;]]
         </code>
        </pre>
        <p class="mt-4">If instead you want to stop parsing as soon a
          single full S-expression has been discovered, you can match
          on the structure of the stack. If the stack is of the form 
         <code class="font-normal text-sm">Sexp (_, Empty)</code>, then
          you know that exactly one S-expression has been parsed and 
         you can stop there.
        </p>
        <h3 class="text-xl my-4 text-gray-900 text-gray-800 font-sans
         anchored" id="parsing-errors">
         <a href="#parsing-errors" class="hover-link inline-block -ml-7 pr-4">
          <span class="align-middle text-gray-200 transition text-sm
           font-sans opacity-0 hover:text-gray-700">#
          </span>
         </a>Parsing errors
        </h3>
        <p class="mt-4">In order to reduce allocations to a minumim, 
         parsing errors are reported via the exception 
         <a href="#exception-Parse_error" class="cursor-pointer text-orange">
          <code class="font-normal text-sm">Parse_error</code>
         </a>. It is the responsibility of the caller to catch this exception
          and return it as an 
         <code class="font-normal text-sm">Error _</code> value. Functions
          that may raise <code class="font-normal text-sm">Parse_error</code>
          are documented as such.
        </p>
        <p class="mt-4">When extracting an atom and the input doesn't
          have enough characters left, the user may raise 
         <code class="font-normal text-sm">Parse_error premature_end_of_input
         </code>. This will produce an error message similar to what 
         the various high-level functions of this library produce.
        </p>
        <h3 class="text-xl my-4 text-gray-900 text-gray-800 font-sans
         anchored" id="building-a-parsing-function">
         <a href="#building-a-parsing-function" class="hover-link
          inline-block -ml-7 pr-4">
          <span class="align-middle text-gray-200 transition text-sm
           font-sans opacity-0 hover:text-gray-700">#
          </span>
         </a>Building a parsing function
        </h3>
        <p class="mt-4">Parsing functions should always follow the following
          pattern:
        </p>
        <ol class="list-decimal mt-2 mb-4">
         <li class="ml-4">create a lexer and start with an empty parsing
           stack
         </li>
         <li class="ml-4">iterate over the input, feeding the lexer 
          characters one by one. When the lexer returns 
          <code class="font-normal text-sm">Atom n</code>, fetch the 
          next <code class="font-normal text-sm">n</code> characters 
          from the input to form an atom
         </li>
         <li class="ml-4">update the stack via 
          <code class="font-normal text-sm">Stack.add_atom</code> or 
          <code class="font-normal text-sm">Stack.add_token</code>
         </li>
         <li class="ml-4">if parsing the whole input, call 
          <code class="font-normal text-sm">Lexer.feed_eoi</code> when
           the end of input is reached, otherwise stop as soon as the
           stack is of the form 
          <code class="font-normal text-sm">Sexp (_, Empty)</code> -
         </li>
        </ol>
        <p class="mt-4">For instance, to parse a string as a list of 
         S-expressions:
        </p>
        <pre class="bg-gray-100 p-3 my-2 overflow-auto">
         <code class="font-normal text-sm">
          module Sexp = struct
            type t =
              | Atom of string
              | List of t list
          end
          
          module Csexp = Csexp.Make (Sexp)
          
          let extract_atom s pos len =
            match String.sub s pos len with
            | exception _ -&gt;
              (* Turn out-of-bounds errors into [Parse_error] *)
              raise (Parse_error premature_end_of_input)
            | s -&gt; s
          
          let parse_string =
            let open Csexp.Parser in
            let rec loop s pos len lexer stack =
              if pos = len then (
                Lexer.feed_eoi lexer;
                Stack.to_list stack
              ) else
                match Lexer.feed lexer (String.unsafe_get s pos) with
                | Atom atom_len -&gt;
                  let atom = extract_atom s (pos + 1) atom_len in
                  loop s (pos + 1 + atom) len lexer (Stack.add_atom atom
          stack)
                | (Await | Lparen | Rparen) as x -&gt;
                  loop s (pos + 1) len lexer (Stack.add_token x stack)
            in
            fun s -&gt;
              match loop s 0 (String.length s) (Lexer.create ()) Empty with
              | v -&gt; Ok v
              | exception Parse_error msg -&gt; Error msg
         </code>
        </pre>
        <div class="mt-8">
         <div class="spec exception anchored p-2 text-sm rounded border-l-4
          border-orange my-3 bg-gray-100" id="exception-Parse_error">
          <a href="#exception-Parse_error" class="hover-link inline-block
           -ml-7 pr-7">
           <span class="align-middle text-gray-200 transition text-sm
            font-sans opacity-0 hover:text-gray-700">#
           </span>
          </a>
          <code class="font-normal text-sm">
           <span><span class="font-semibold">exception</span> </span>
           <span><span class="">Parse_error</span> 
            <span class="font-semibold">of</span> string
           </span>
          </code>
         </div>
        </div>
        <div class="mt-8">
         <div class="spec value anchored p-2 text-sm rounded border-l-4
          border-orange my-3 bg-gray-100" id="val-premature_end_of_input">
          <a href="#val-premature_end_of_input" class="hover-link
           inline-block -ml-7 pr-7">
           <span class="align-middle text-gray-200 transition text-sm
            font-sans opacity-0 hover:text-gray-700">#
           </span>
          </a>
          <code class="font-normal text-sm">
           <span><span class="font-semibold">val</span> 
            premature_end_of_input : string
           </span>
          </code>
         </div>
         <div class="spec-doc">
          <p class="mt-4">Error message signaling the end of input was
            reached prematurely. You can use this when extracting an 
           atom from the input and the input doesn't have enough characters.
          </p>
         </div>
        </div>
        <div class="mt-8">
         <div class="spec module anchored p-2 text-sm rounded border-l-4
          border-orange my-3 bg-gray-100" id="module-Lexer">
          <a href="#module-Lexer" class="hover-link inline-block -ml-7 pr-7">
           <span class="align-middle text-gray-200 transition text-sm
            font-sans opacity-0 hover:text-gray-700">#
           </span>
          </a>
          <code class="font-normal text-sm">
           <span><span class="font-semibold">module</span> </span>
           <span>
            <a href="Lexer/index.html" class="cursor-pointer text-orange">
             Lexer
            </a>
           </span>
           <span> : <span class="font-semibold">sig</span> ... 
            <span class="font-semibold">end</span>
           </span>
          </code>
         </div>
         <div class="spec-doc"><p class="mt-4">Lexical analyser</p></div>
        </div>
        <div class="mt-8">
         <div class="spec module anchored p-2 text-sm rounded border-l-4
          border-orange my-3 bg-gray-100" id="module-Stack">
          <a href="#module-Stack" class="hover-link inline-block -ml-7 pr-7">
           <span class="align-middle text-gray-200 transition text-sm
            font-sans opacity-0 hover:text-gray-700">#
           </span>
          </a>
          <code class="font-normal text-sm">
           <span><span class="font-semibold">module</span> </span>
           <span>
            <a href="Stack/index.html" class="cursor-pointer text-orange">
             Stack
            </a>
           </span>
           <span> : <span class="font-semibold">sig</span> ... 
            <span class="font-semibold">end</span>
           </span>
          </code>
         </div><div class="spec-doc"><p class="mt-4">Parsing stack</p></div>
        </div>
       </div>
      </div>
      <div class="w-full flex-none lg:w-72 border-t lg:border-l bg-gray-100">
       <div class="flex h-20 border-b relative">
        <h2 class="text-xl absolute inset-x-0 p-3 bottom-0 mt-7 font-semibold
         text-gray-500">csexp.1.5.1
        </h2>
       </div>
       <div class="m-3">
        <p class="mb-5 italic text-sm">
         Parsing and printing of S-expressions in Canonical form
        </p>
        <div class="mb-3">
         <div class="flex space-x-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
  <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 00-1.414 1.414 4 4 0 005.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 00-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
</svg>
          <a class="text-orange cursor-pointer mb-2 text-sm"
           href="https://github.com/ocaml-dune/csexp">
           github.com/ocaml-dune/csexp
          </a>
         </div>
         <div class="flex space-x-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
  <path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1.323l3.954 1.582 1.599-.8a1 1 0 01.894 1.79l-1.233.616 1.738 5.42a1 1 0 01-.285 1.05A3.989 3.989 0 0115 15a3.989 3.989 0 01-2.667-1.019 1 1 0 01-.285-1.05l1.715-5.349L11 6.477V16h2a1 1 0 110 2H7a1 1 0 110-2h2V6.477L6.237 7.582l1.715 5.349a1 1 0 01-.285 1.05A3.989 3.989 0 015 15a3.989 3.989 0 01-2.667-1.019 1 1 0 01-.285-1.05l1.738-5.42-1.233-.617a1 1 0 01.894-1.788l1.599.799L9 4.323V3a1 1 0 011-1zm-5 8.274l-.818 2.552c.25.112.526.174.818.174.292 0 .569-.062.818-.174L5 10.274zm10 0l-.818 2.552c.25.112.526.174.818.174.292 0 .569-.062.818-.174L15 10.274z" clip-rule="evenodd" />
</svg>
          <a class="text-orange cursor-pointer mb-2 text-sm"
           href="../../../LICENSE.md.html">LICENSE.md
          </a>
         </div>
         <div class="flex space-x-2">
          
    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
  <path d="M9 4.804A7.968 7.968 0 005.5 4c-1.255 0-2.443.29-3.5.804v10A7.969 7.969 0 015.5 14c1.669 0 3.218.51 4.5 1.385A7.962 7.962 0 0114.5 14c1.255 0 2.443.29 3.5.804v-10A7.968 7.968 0 0014.5 4c-1.255 0-2.443.29-3.5.804V12a1 1 0 11-2 0V4.804z" />
</svg>
    
          <a class="text-orange cursor-pointer mb-2 text-sm"
           href="../../../README.md.html">README.md
          </a>
         </div>
         <div class="flex space-x-2">
          
  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z" clip-rule="evenodd" />
</svg>
  
          <a class="text-orange cursor-pointer mb-2 text-sm"
           href="../../../CHANGES.md.html">CHANGES.md
          </a>
         </div>
        </div>
        <details class="font-normal mb-2 text-sm">
         <summary>Other versions</summary><div id="versions_container"></div>
        </details><h2 class="font-semibold mb-2 text-sm">Authors</h2>
        <p class="mb-3 text-sm">
         Quentin Hocquet &lt;mefyl@gruntech.org&gt;,Jane Street Group,
         LLC,Jeremie Dimino &lt;jeremie@dimino.org&gt;
        </p><h2 class="font-semibold mb-2 text-sm">Issues</h2>
        <div class="mb-3">
         <a class="text-orange cursor-pointer mb-2 text-sm"
          href="https://github.com/ocaml-dune/csexp/issues">
          github.com/ocaml-dune/csexp/issues
         </a>
        </div>
        <details class="font-semibold mb-2 text-sm">
         <summary>Package dependencies</summary>
         <div class="font-normal">
          <ul>
           <li>
            <a href="../../../../../dune/index.html" class="text-orange
             cursor-pointer">dune
            </a>
           </li>
           <li>
            <a href="../../../../../ocaml/index.html" class="text-orange
             cursor-pointer">ocaml
            </a>
           </li>
           <li>
            <a href="../../../../../odoc/index.html" class="text-orange
             cursor-pointer">odoc
            </a>
           </li>
          </ul>
         </div>
        </details>
       </div>
      </div>
     </div>
    </div>
   </div>
  </div><script>Voodoo.update('../../../../version.json')</script>
 </body>
</html>